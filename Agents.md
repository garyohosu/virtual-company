# ğŸ¤– Agents - è‡ªå‹•å®Ÿè¡Œãƒ«ãƒ¼ãƒ«

**ä½œæˆæ—¥**: 2026-01-31  
**ç›®çš„**: ã™ã¹ã¦ã® AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆClaude, Gemini ãªã©ï¼‰ãŒå¾“ã†ã¹ãçµ±ä¸€ãƒ«ãƒ¼ãƒ«

---

## âš ï¸ é‡è¦: CLIãƒ„ãƒ¼ãƒ« ãŒã€Œgit pullã€ã‚’æ¤œå‡ºã—ã¦è‡ªå‹•å®Ÿè¡Œã™ã‚‹ä»•çµ„ã¿

```
ğŸ¯ ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã®æµã‚Œï¼š

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ CLI ãƒ„ãƒ¼ãƒ«ï¼ˆGemini CLIï¼‰ã®ãƒãƒ£ãƒƒãƒˆã«ã€Œgit pullã€ã¨æ›¸ã
   â†“
CLI ãƒ„ãƒ¼ãƒ« ãŒã€Œgit pullã€ã‚’å®Ÿè¡Œ
   â†“
CLI ãƒ„ãƒ¼ãƒ« ãŒå®Ÿè¡Œãƒ­ã‚°ã‚’èª­ã‚€
   â†“
ã€Œæ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¿½åŠ ã•ã‚ŒãŸã€ã¨åˆ¤æ–­
   â†“
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆAgents.md / Claude.md / Gemini.mdï¼‰ã®ãƒ«ãƒ¼ãƒ« ã«å¾“ã†
   â†“
instructions/ ã®æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å®Ÿè¡Œ
```

**ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ**: 
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯CLIãƒ„ãƒ¼ãƒ«ã®ãƒãƒ£ãƒƒãƒˆã«ã€Œgit pullã€ã¨æ›¸ãã ã‘
- CLIãƒ„ãƒ¼ãƒ« ãŒ ãƒ­ã‚°ã‹ã‚‰ æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º
- è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆæ‰‹å‹•æ“ä½œä¸è¦ï¼‰
```

---

## ğŸ”„ è‡ªå‹•å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ï¼ˆè©³ç´°ï¼‰

```
1ï¸âƒ£ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ CLI ãƒ„ãƒ¼ãƒ«ï¼ˆGemini CLIï¼‰ã®ãƒãƒ£ãƒƒãƒˆã«ã€Œgit pullã€ã¨æ›¸ã
   â””â”€ ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œgit pullã€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

2ï¸âƒ£ CLI ãƒ„ãƒ¼ãƒ«ãŒã€Œgit pullã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
   â””â”€ cd ~/garyohosu/virtual-company && git pull origin main

3ï¸âƒ£ CLI ãƒ„ãƒ¼ãƒ« ãŒå®Ÿè¡Œãƒ­ã‚°ã‚’èª­ã‚€
   â”œâ”€ stdout ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼š
   â”‚  â”œâ”€ ã€ŒUpdated c088e02..0f36df1ã€ï¼ˆæ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆï¼‰
   â”‚  â”œâ”€ ã€Œ Agents.md | 2 +-ã€ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ï¼‰
   â”‚  â”œâ”€ ã€Œ instructions/order_xxx.sh | 50 +++ã€ï¼ˆæ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
   â”‚  â””â”€ ã€Œ instructions/order_yyy.md | 30 +++ã€ï¼ˆæ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
   â””â”€ ãƒ­ã‚°ã‚’è§£æã—ã¦ã€Œæ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¿½åŠ ã•ã‚ŒãŸã€ã¨åˆ¤æ–­

4ï¸âƒ£ CLI ãƒ„ãƒ¼ãƒ« ãŒ ãƒ«ãƒ¼ãƒˆã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€
   â”œâ”€ ./Agents.md     â† çµ±ä¸€ãƒ«ãƒ¼ãƒ«
   â”œâ”€ ./Claude.md     â† Claude è¨­å®š
   â””â”€ ./Gemini.md     â† è‡ªåˆ†ã®å½¹å‰²

5ï¸âƒ£ CLI ãƒ„ãƒ¼ãƒ« ãŒ instructions/ ã‚’ã‚¹ã‚­ãƒ£ãƒ³
   â”œâ”€ git pull ã®ãƒ­ã‚°ã‹ã‚‰æ¤œå‡ºã•ã‚ŒãŸæ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ ãƒªã‚¹ãƒˆåŒ–
   â”œâ”€ .last_agent_run ã§ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ç®¡ç†
   â””â”€ å®Ÿè¡Œé †åºã‚’æ±ºå®šï¼šSETUP > order > TEST

6ï¸âƒ£ CLI ãƒ„ãƒ¼ãƒ« ãŒ æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å®Ÿè¡Œ
   â”œâ”€ instructions/order_magicboxai_ui.sh
   â”œâ”€ instructions/order_sakura_deploy.sh
   â”œâ”€ instructions/TEST_magicboxai.md
   â””â”€ å®Ÿè¡Œãƒ­ã‚°ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤º

7ï¸âƒ£ å®Ÿè¡Œçµæœã‚’ãƒ¬ãƒãƒ¼ãƒˆ
   â”œâ”€ stdout ã«ã€Œâœ… å®Œäº†ã€ã¨è¡¨ç¤º
   â”œâ”€ .last_agent_run ã‚’æ›´æ–°
   â””â”€ Git ã«è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆ & ãƒ—ãƒƒã‚·ãƒ¥

8ï¸âƒ£ å®Œäº†ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«çµæœã‚’å ±å‘Šï¼‰
   â””â”€ ã™ã¹ã¦è‡ªå‹•ã§å®Œäº†ï¼
```

---

## ğŸ“‹ å®Ÿè¡Œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

### âœ… å®Ÿè¡Œå¯¾è±¡

```
instructions/*.sh          â† Bash ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæœ€å„ªå…ˆï¼‰
instructions/order_*.md    â† æŒ‡ç¤ºæ›¸ï¼ˆMarkdownï¼‰
instructions/*SETUP*.md    â† ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–¢é€£
instructions/*TEST*.sh     â† ãƒ†ã‚¹ãƒˆé–¢é€£
```

### âŒ ã‚¹ã‚­ãƒƒãƒ—å¯¾è±¡

```
instructions/CLAUDE_MEMORY.md          â† è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
instructions/*_backup.md               â† ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
instructions/_*.md                     â† ä¸‹æ›¸ã
00_README_START_HERE.md                â† èª¬æ˜ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ğŸ› ï¸ CLI ãƒ„ãƒ¼ãƒ«å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

### ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ 1: ãƒ­ã‚°è§£æ

```python
# git pull ã®å®Ÿè¡Œãƒ­ã‚°ã‹ã‚‰æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º
import subprocess
import re

def detect_new_files_from_log():
    """git pull ã®ãƒ­ã‚°ã‹ã‚‰æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º"""
    
    result = subprocess.run(
        ['git', 'pull', 'origin', 'main'],
        capture_output=True,
        text=True
    )
    
    log = result.stdout + result.stderr
    
    # git pull ã®å‡ºåŠ›ã‹ã‚‰æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º
    # ä¾‹: " instructions/order_xxx.sh | 50 +++"
    new_files = re.findall(
        r'^\s+(instructions/\S+)\s+\|',
        log,
        re.MULTILINE
    )
    
    return new_files
```

### ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ 2: è‡ªå‹•å®Ÿè¡Œåˆ¤å®š

```python
def should_execute(filepath):
    """ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã¹ãã‹åˆ¤æ–­"""
    
    # å®Ÿè¡Œå¯¾è±¡
    if filepath.endswith('.sh'):
        return True
    
    if filepath.endswith('.md') and 'order_' in filepath:
        return True
    
    # ã‚¹ã‚­ãƒƒãƒ—å¯¾è±¡
    if 'CLAUDE_MEMORY' in filepath:
        return False
    
    if filepath.startswith('_'):
        return False
    
    return False
```

### ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ 3: å®Ÿè¡Œé †åºã®ç®¡ç†

```python
def get_execution_order(files):
    """å®Ÿè¡Œé †åºã‚’æ±ºå®š"""
    
    setup_files = [f for f in files if 'SETUP' in f and f.endswith('.sh')]
    order_files = [f for f in files if f.startswith('order_') and f.endswith('.sh')]
    test_files = [f for f in files if 'TEST' in f and f.endswith('.sh')]
    md_files = [f for f in files if f.endswith('.md')]
    
    # å„ªå…ˆåº¦é †
    return setup_files + order_files + test_files + md_files
```

---

## ğŸ“ å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®å‘½åè¦å‰‡

### âœ… æ¨å¥¨å½¢å¼

```
instructions/order_PROJECTNAME_DESCRIPTION.md
instructions/order_PROJECTNAME_DESCRIPTION.sh

examples:
  âœ“ instructions/order_magicboxai_ui_update.sh
  âœ“ instructions/order_sakura_deploy.md
  âœ“ instructions/SETUP_phase3.md
  âœ“ instructions/TEST_local.sh
```

### å®Ÿè¡Œå„ªå…ˆåº¦

```
1ï¸âƒ£ *SETUP*.sh       â† ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæœ€å„ªå…ˆï¼‰
2ï¸âƒ£ order_*.sh      â† æŒ‡ç¤ºã‚¹ã‚¯ãƒªãƒ—ãƒˆ
3ï¸âƒ£ *TEST*.sh       â† ãƒ†ã‚¹ãƒˆ
4ï¸âƒ£ order_*.md      â† ãã®ä»–æŒ‡ç¤ºæ›¸
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„äº‹é …

```
âš ï¸ ãƒ­ã‚°è§£æã®æ­£ç¢ºæ€§
  â””â”€ git pull ã®å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ä¾å­˜
  â””â”€ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆå‰Šé™¤ãƒ•ã‚¡ã‚¤ãƒ«ç­‰ï¼‰ã«å¯¾å¿œ

âš ï¸ å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼
  â””â”€ Git ã®ç½²åç¢ºèªã‚’æ¨å¥¨
  â””â”€ ä¿¡é ¼ã§ãã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®ã¿

âš ï¸ ç„¡é™ãƒ«ãƒ¼ãƒ—ã®é˜²æ­¢
  â””â”€ åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã®2å›å®Ÿè¡Œã‚’é¿ã‘ã‚‹
  â””â”€ .last_agent_run ã§ç®¡ç†

âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  â””â”€ å®Ÿè¡Œå¤±æ•—æ™‚ã‚‚è¨˜éŒ²
  â””â”€ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹
```

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆCLIå®Ÿè£…æ™‚ï¼‰

```
â–¡ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã€Œgit pullã€ã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘å–ã‚‹
â–¡ git pull ã‚’å®Ÿè¡Œ
â–¡ å®Ÿè¡Œãƒ­ã‚°ã‚’èª­ã‚€
â–¡ ãƒ­ã‚°ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’æ¤œå‡º
â–¡ ãƒ«ãƒ¼ãƒˆã® Agents.md ã‚’èª­ã¿è¾¼ã¿
â–¡ ãƒ«ãƒ¼ãƒˆã® Claude.md ã‚’èª­ã¿è¾¼ã¿ï¼ˆif availableï¼‰
â–¡ ãƒ«ãƒ¼ãƒˆã® Gemini.md ã‚’èª­ã¿è¾¼ã¿ï¼ˆif availableï¼‰
â–¡ instructions/ ã‚’ã‚¹ã‚­ãƒ£ãƒ³
â–¡ æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º
â–¡ CLAUDE_MEMORY.md ãªã©è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—
â–¡ ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œé †åºã‚’ç®¡ç†
â–¡ .sh ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ bash ã§å®Ÿè¡Œ
â–¡ .md ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤º or è§£æ
â–¡ å®Ÿè¡Œçµæœã‚’ãƒ¬ãƒãƒ¼ãƒˆ
â–¡ .last_agent_run ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ›´æ–°
â–¡ Git ã«ã‚³ãƒŸãƒƒãƒˆ & ãƒ—ãƒƒã‚·ãƒ¥
â–¡ ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
```

---

## ğŸ’¡ å®Ÿè£…ä¾‹ï¼ˆGemini CLI ç”¨ï¼‰

```python
#!/usr/bin/env python3
import os
import subprocess
import glob
import re
from datetime import datetime
from pathlib import Path

class VirtualCompanyAgent:
    def __init__(self):
        self.repo_dir = Path.home() / "garyohosu" / "virtual-company"
        self.instructions_dir = self.repo_dir / "instructions"
        self.last_run_file = self.repo_dir / ".last_agent_run"
    
    def run(self, command):
        """ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒ­ã‚°ã‚’å–å¾—"""
        result = subprocess.run(
            command,
            shell=True,
            capture_output=True,
            text=True,
            cwd=self.repo_dir
        )
        return result.stdout, result.stderr, result.returncode
    
    def detect_new_files(self):
        """git pull ã®ãƒ­ã‚°ã‹ã‚‰æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º"""
        print("ğŸ“¦ git pull ã‚’å®Ÿè¡Œä¸­...")
        stdout, stderr, code = self.run("git pull origin main")
        
        log = stdout + stderr
        print(f"ãƒ­ã‚°:\n{log}\n")
        
        # git pull ã®å‡ºåŠ›ã‹ã‚‰ instructions/ ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º
        new_files = re.findall(
            r'^\s+(instructions/\S+)\s+\|',
            log,
            re.MULTILINE
        )
        
        return new_files
    
    def load_config(self):
        """ãƒ«ãƒ¼ãƒˆã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚€"""
        print("ğŸ“– è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿...")
        for f in ["Agents.md", "Claude.md", "Gemini.md"]:
            if (self.repo_dir / f).exists():
                print(f"âœ“ {f} èª­ã¿è¾¼ã¿å®Œäº†")
    
    def should_execute(self, filepath):
        """ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã¹ãã‹åˆ¤æ–­"""
        # ã‚¹ã‚­ãƒƒãƒ—å¯¾è±¡
        skip_patterns = ['CLAUDE_MEMORY', '_', 'README', 'backup']
        for pattern in skip_patterns:
            if pattern in filepath:
                return False
        
        # å®Ÿè¡Œå¯¾è±¡
        if filepath.endswith('.sh') or (filepath.endswith('.md') and 'order_' in filepath):
            return True
        
        return False
    
    def get_execution_order(self, files):
        """å®Ÿè¡Œé †åºã‚’æ±ºå®š"""
        setup = sorted([f for f in files if 'SETUP' in f and f.endswith('.sh')])
        order = sorted([f for f in files if 'order_' in f and f.endswith('.sh')])
        test = sorted([f for f in files if 'TEST' in f and f.endswith('.sh')])
        md = sorted([f for f in files if f.endswith('.md')])
        
        return setup + order + test + md
    
    def execute_file(self, filepath):
        """ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ"""
        print(f"\nâ–¶ï¸  å®Ÿè¡Œä¸­: {filepath}")
        print("=" * 50)
        
        full_path = self.repo_dir / filepath
        
        if full_path.suffix == '.sh':
            stdout, stderr, code = self.run(f"bash {filepath}")
        elif full_path.suffix == '.md':
            stdout = full_path.read_text()
            code = 0
        else:
            return False
        
        print(stdout)
        if stderr:
            print(f"stderr: {stderr}")
        
        print("=" * 50)
        
        if code == 0:
            print(f"âœ… å®Œäº†: {filepath}")
        else:
            print(f"âŒ å¤±æ•—: {filepath} (exit: {code})")
        
        return code == 0
    
    def update_timestamp(self):
        """ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ›´æ–°"""
        now = datetime.now().isoformat()
        self.last_run_file.write_text(now)
        
        print(f"\nğŸ“ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ›´æ–°: {now}")
        self.run("git add .last_agent_run")
        self.run("git commit -m 'chore: Update agent timestamp'")
        self.run("git push origin main")
    
    def main(self):
        """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
        os.chdir(self.repo_dir)
        
        print("ğŸ¤– Virtual Company ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ\n")
        
        # Step 1: git pull ã§æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œå‡º
        new_files = self.detect_new_files()
        
        if not new_files:
            print("âœ… æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“")
            return
        
        # Step 2: è¨­å®šã‚’èª­ã‚€
        self.load_config()
        
        # Step 3: å®Ÿè¡Œå¯¾è±¡ã‚’æ±ºå®š
        executable_files = [f for f in new_files if self.should_execute(f)]
        
        if not executable_files:
            print("âœ… å®Ÿè¡Œå¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“")
            return
        
        # Step 4: å®Ÿè¡Œé †åºã‚’æ±ºå®š
        ordered_files = self.get_execution_order(executable_files)
        
        print(f"\nğŸ†• å®Ÿè¡Œå¯¾è±¡: {len(ordered_files)} å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«")
        
        # Step 5: å®Ÿè¡Œ
        for filepath in ordered_files:
            self.execute_file(filepath)
        
        # Step 6: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ›´æ–°
        self.update_timestamp()
        
        print("\nğŸ‰ ã™ã¹ã¦å®Œäº†ï¼")

if __name__ == "__main__":
    agent = VirtualCompanyAgent()
    agent.main()
```

---

**ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã€Œgit pullã€ã¨æ›¸ãã ã‘ã§å®Œå…¨è‡ªå‹•åŒ–ï¼** ğŸš€âœ¨
